---
title: "Update Trandsducer Data - v2"
author: "Maddee Wiggins (FlowWest)"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)

knitr::opts_chunk$set(echo = TRUE)

palette <- c("#999999", "#E69F00", "#56B4E9", "#F0E442", "#009E73", "#CC79A7")

```

## Source Data 

This script will compile all transducer data that is located in the `data-raw/surface_water/compensated_data` folder

First, source script:

TODO: note that `seconds` column is not reading in correctly. Check to make sure this is okay.

```{r echo=TRUE, message=FALSE, warning=FALSE}
source(here::here("analysis","surface_water", "run_all_files.R"))
```

```{r}
all_surface_water |> glimpse()
```

## Visualize and Explore Data 

Next, visualize the data to make sure everything appended and updated correctly.

```{r}
all_surface_water |> 
  group_by(name) |>
  summarise(min_date = min(datetime),
            max_date = max(datetime),
            n = n()) |> 
  knitr::kable()

```

### Water Depth

```{r fig.height=9, fig.width=11}
ggplot(data = all_surface_water, aes(x = datetime, y = depth_ft, color = name)) +     
  geom_line() + 
  scale_color_manual(values = palette) +
  labs(color = "Transducer Location", x = "Datetime", y = "Water Depth (ft)") +
  theme_minimal() 

```

### Pressure

```{r fig.height=9, fig.width=11}
ggplot(data = all_surface_water, aes(x = datetime, y = pressure_psi, color = name)) +     
  geom_line() + 
  scale_color_manual(values = palette) +
  labs(color = "Transducer Location", x = "Datetime", y = "Pressure (psi)") +
  theme_minimal()
```

### Temperature 

```{r fig.height=9, fig.width=11}
ggplot(data = all_surface_water, aes(x = datetime, y = temperature_f, color = name)) +     
  geom_line() + 
  scale_color_manual(values = palette) +
  labs(color = "Transducer Location", x = "Datetime", y = "Temperature (f)") +
  theme_minimal()

```

## Save aggregated data 

Now save an Rdata file of aggregated surface water data in the `data/surface_water` folder

```{r}
all_surface_water |> saveRDS(here::here("data", "surface_water", "surface_water_data_aggregated.RDS"))

```
